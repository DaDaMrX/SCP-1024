<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Chat Bot</title>
    <script src="./jquery-3.3.1.min.js.css"></script>
    <link rel="stylesheet" href="./bootstrap.min.css">
    <script src="./bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        #chat-list {
            margin-bottom: 50%;
        }
        .navbar-brand {
            position: absolute;
            width: 100%;
            left: 0;
            text-align: center;
            margin:0 auto;
        }
    </style>

</head>

<body>
    <nav class="navbar navbar-default" role="navigation">
        <a class="navbar-brand" href="#">Chat Bot</a>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <div id="chat-list" class="list-group">
                    <div id="item-template" class="list-group-item" style="display:none">
                        <h4 class="list-group-item-heading">
                            <span class="glyphicon" aria-hidden="true"></span>
                            <span class="message">Message</span>
                        </h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="navbar navbar-default navbar-fixed-bottom">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3">
                    <div class="input-group input-group-lg ">
                        <input id="input" type="text" class="form-control">
                        <span class="input-group-btn">
                            <button id="send" class="btn btn-success" type="button">Send</button>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var item_id = 0
        sendAjax("[begin]")
        function addChatItem(speaker, message) {
            var item = $("#item-template").clone()
            item_id += 1
            item.attr("id", item_id)
            var speaker_icon, text_align
            if (speaker == "user") {
                item.css("text-align", "right")
                item.find(".glyphicon").addClass("glyphicon-user")
                item.find(".glyphicon").css("margin-left", "10px")
                item.find("span.glyphicon").before(item.find("span.message"))
            } else {
                item.css("text-align", "left")
                item.find(".glyphicon").addClass("glyphicon-cloud")
                item.find(".glyphicon").css("margin-right", "10px")
            }
            item.find("span.message").html(message)
            item.css("display", "")
            $("#chat-list").append(item)
        }
        function sendAjax(question) {
            $.ajax({
                type: "POST",
                url: "/chat",
                data: JSON.stringify({ "text": question }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#input").val("")
                    addChatItem("agent", data["text"])
                },
                failure: function (error) {
                    alert(error);
                }
            })
        }
        function sendMessage() {
            var question = $("#input").val()
            if (question === "") return
            addChatItem("user", question)
            sendAjax(question)
        }
        $("#input").keypress(function (key) {
            if (key.which == 13) sendMessage()
        })
        $("#send").click(sendMessage)
    </script>
</body>

</html>